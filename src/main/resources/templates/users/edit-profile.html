<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Profile-Edit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
<div th:fragment="navbar">
    <div th:replace="partials/navbar"></div>
</div>
<form action="#" th:action="@{/profile/edit}" th:object="${user}" method="post">
    <label for="username">Username</label>
    <input id="username" th:field="*{username}" />

    <label for="email">Email</label>
    <input id="email" th:field="*{email}" />

    <label for="profileImageInput" class="custom-file-upload">
        Choose your profile image
    </label>
    <input type="file" id="profileImageInput" style="display: none;"/>
    <img src="" th:src="${user.profileImage}" alt="image" id="profileImage" height="34" class="rounded-circle">
    <input type="hidden" id="profileImageUrl" name="profileImage">

    <div sec:authorize="isAuthenticated()">
        <input value="Save changes" type="submit" />
    </div>
</form>
<script th:inline="javascript">
    /*<![CDATA[*/
    var filestackKey = /*[[${filestackKey}]]*/ 'default';
    /*]]>*/
</script>
<script src="https://static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script>
    const client = filestack.init(filestackKey);
    const profilePic = document.getElementById("profileImage");
    const profileFileInput = document.getElementById("profileImageInput");
    const profileImageUrlInput = document.getElementById("profileImageUrl");

    profileFileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];

        client.upload(file).then((response) => {
            profilePic.src = response.url;
            profileImageUrlInput.value = response.url;
        }).catch((error) => {
            console.log(error);
        });
    });
</script>
<th:block th:replace="partials/navbar-scripts :: navbar-scripts"></th:block>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>

</html>